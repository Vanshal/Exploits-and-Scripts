# Source - https://codingo.io/ctf/writeup/programming/crikeycon/2017/03/08/crikeycon-2017-fastmath.html

#!/usr/bin/python3
 
import socket
import re
import time

MAXBUF = 4096
SENTINEL = 'flag'
CTF_BOT = ('IP', PORT)
 
if __name__ == '__main__':
    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    client.connect(CTF_BOT)
 
    while True:
        data = b''
        # receive and store data
        while True:
            chunk = client.recv(MAXBUF)
            data += chunk
            if len(chunk) < MAXBUF:
                break
        decoded = data.decode('utf-8')
        print(decoded)
        if SENTINEL in decoded:
            print(decoded)
            break
 
        match = re.search('x =.*', decoded)
        if not match:
            raise ValueError("Invalid expression string")
       
        b = match.group(0)
        # print(match) 
        expression = b[4:] 
        # print(expression) 
        result = eval(expression)
        print(expression + ' = ' + str(result))
        data = str(result).encode('utf-8') + b'\n'
        print('Sending: ' + str(result))
        client.send(data)
        time.sleep(0.8)
